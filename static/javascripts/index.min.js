$(function(){var s=$("#player");var q=["hero","fadingred","tenniselbow","springtraveller","lovethepastplaythefuture","feelslikerain"];var k=false;var a=[];var l=a[Math.floor(Math.random()*a.length)]||[];var n=l.length;var d=$("#music > a");var t=$("#play");var h=$("#pause");var p=$("#next");var j=0;var u=false;var g=false;s.on("ended",function(){i()});s.on("error",function(){i()});t.on("click",function(){if(!t.hasClass("active")&&!u){v()}});h.on("click",function(){if(!h.hasClass("active")&&!u){f()}});p.on("click",function(){if(!u){i()}});d.on("click",function(){if(!u){if(t.hasClass("active")){f()}else{v()}}});function v(){g=true;t.addClass("active");h.removeClass("active");s[0].play()}function f(){g=false;t.removeClass("active");h.addClass("active");s[0].pause()}function i(){f();var w=s.attr("title");var x=l[++j%n];while(w===x){x=l[++j%n]}m(x)}function m(x){e();if(k){b();s.attr("title",x);s.attr("src","http://homfen.me/static/songs/"+x+".mp3");v();return}var w=$.post("./api/music",{id:x});w.done(function(y){if(y!==""){b();s.attr("title",x);s.attr("src",y);v()}else{i()}});w.fail(function(){i()})}function r(x,w){return Math.random()>0.5?-1:1}function e(){$("#songloading").removeClass("hide");u=true}function b(){$("#songloading").addClass("hide");u=false}if(true||window.AudioContext){k=true;n=q.length;l=q;l.sort(r);l.unshift("szjz","gbqq");m(l[0]);c();o(s[0])}else{l.sort(r);m(l[0])}$.post("./api/weather",null,function(P){P=JSON.parse(P);$("#send").data("user",P.ip||P.retData.city);if(P.errNum===0){var E=P.retData;var y=new Date();var A=y.toISOString();A=A.slice(0,A.indexOf("T"));var N=E.sunrise;var C=E.sunset;var G=new Date(Date.parse(A+"T"+N+":00.000Z"));var K=new Date(Date.parse(A+"T"+C+":00.000Z"));var O=false;if(G<y&&y<K){O=true}var J=E.weather;var x=J.indexOf("晴")>=0;var F=J.indexOf("云")>=0;var w=J.indexOf("雨")>=0;var D=J.indexOf("雪")>=0;var B=J.indexOf("雷")>=0;var H=J.indexOf("阴")>=0;var I=J.indexOf("雹")>=0;var L=$("#weather");var z="sun";if(x&&F){z="suncloudy"}else{if(F){z="cloudy"}else{if(x){z="sun"}else{if(w&&D){z="rainsnow"}else{if(w){z="rain"}else{if(D){z="snow"}else{if(B){z="light"}else{if(H){z="overcast"}else{if(I){z="ice"}}}}}}}}}if((x||F)&&!O){z+="night"}L.addClass(z);var Q=[E.city+"："+J];var M=E.temp+"摄氏度";if(E.h_tmp&&E.l_tmp){M+="("+E.l_tmp+"~"+E.h_tmp+")"}Q.push(M);Q.push("<br/>日出："+N);Q.push("日落："+C);if(E.WS){Q.push("<br/>"+E.WD+"，"+E.WS)}$("#weatherDetail").html(Q.join("，"))}});$("#weatherNav").on("mouseover",function(){$("#weather").slideDown()}).on("mouseout",function(){$("#weather").fadeOut()});$("#send").on("click",function(){var w=$("#question").val().trim();if(w){$("#evasay").html("...");$.post("./api/answer",{question:w,user:$("#send").data("user")},function(z){z=JSON.parse(z);var x="呵呵，我也不知道呢~";var y=z.code;if(!(40000<y&&y<40008)){x=z.text;if(z.url){x+='，<a href="'+z.url+'" target="_blank">查看详情>></a>'}if(z.list){z.list.forEach(function(A){x+='<br/><a href="'+A.detailurl+'" target="_blank">'+(A.article||A.name)+"</a>"})}}$("#evasay").html(x)})}});function c(){var w=$("#rhythm");var y=$(window).width();var z=0;while((z-1)*3<=y){var x=$('<div class="column"></div>');x.css("left",z*3+"px");w.append(x);z++}}function o(B){var A=new AudioContext();var y=A.createAnalyser();var C=A.createMediaElementSource(B);C.connect(y);y.connect(A.destination);y.fftSize=1024;var x=new Uint8Array(y.frequencyBinCount);var z=$("#rhythm .column");var w=z.length;function D(){if(g){y.getByteFrequencyData(x);for(var E=0;E<w;E++){var G=x[E]*-100/256;z[E].style.transform="translateY( "+G+"px) translateZ(0)"}requestAnimationFrame(D)}else{var F=setInterval(function(){if(g){clearInterval(F);D()}},100)}}D()}});