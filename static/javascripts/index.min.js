$(function(){var m=$("#player");var a=["hero","fadingred","tenniselbow","springtraveller","lovethepastplaythefuture","feelslikerain"];var o=a.length;var g=$("#music > a");var b=$("#play");var q=$("#pause");var f=$("#next");var h=0;var n=false;var d=false;m.on("ended",function(){e()});m.on("error",function(){e()});b.on("click",function(){if(!b.hasClass("active")&&!n){c()}});q.on("click",function(){if(!q.hasClass("active")&&!n){l()}});f.on("click",function(){if(!n){e()}});g.on("click",function(){if(!n){if(b.hasClass("active")){l()}else{c()}}});function c(){d=true;b.addClass("active");q.removeClass("active");m[0].play()}function l(){d=false;b.removeClass("active");q.addClass("active");m[0].pause()}function e(){l();var r=m.attr("title");var s=a[++h%o];while(r===s){s=a[++h%o]}p(s)}function p(r){m.attr("title",r);m.attr("src","http://homfen.me/static/songs/"+r+".mp3");c()}function k(s,r){return Math.random()>0.5?-1:1}a.unshift("szjz","gbqq");o=a.length;a.sort(k);p(a[0]);if(window.AudioContext){i();j(m[0])}$("#send").on("click",function(){var r=$("#question").val().trim();if(r){$("#evasay").html("...");$.post("./api/answer",{question:r,user:$("#send").data("user")},function(u){u=JSON.parse(u);var s="呵呵，我也不知道呢~";var t=u.code;if(!(40000<t&&t<40008)){s=u.text;if(u.url){s+='，<a href="'+u.url+'" target="_blank">查看详情>></a>'}if(u.list){u.list.forEach(function(v){s+='<br/><a href="'+v.detailurl+'" target="_blank">'+(v.article||v.name)+"</a>"})}}$("#evasay").html(s)})}});function i(){var r=$("#rhythm");var t=$(window).width();var u=0;while((u-1)*3<=t){var s=$('<div class="column"></div>');s.css("left",u*3+"px");r.append(s);u++}}function j(w){var v=new AudioContext();var t=v.createAnalyser();var x=v.createMediaElementSource(w);x.connect(t);t.connect(v.destination);t.fftSize=1024;var s=new Uint8Array(t.frequencyBinCount);var u=$("#rhythm .column");var r=u.length;function y(){if(d){t.getByteFrequencyData(s);for(var z=0;z<r;z++){var B=s[z]*-100/256;u[z].style.transform="translateY( "+B+"px) translateZ(0)"}requestAnimationFrame(y)}else{var A=setInterval(function(){if(d){clearInterval(A);y()}},100)}}y()}});